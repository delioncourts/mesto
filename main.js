(()=>{"use strict";document.querySelector(".popup_type_open-card"),document.querySelector(".popup__open-photo"),document.querySelector(".popup__open-photo-subtitle");var e=document.querySelector(".popup__input_type_name"),t=document.querySelector(".popup__input_type_job"),r=document.querySelector(".popup_type_edit"),s=document.querySelector(".popup_type_add-card"),i=document.querySelector(".popup_type_avatar"),n=document.querySelector(".profile__edit"),o=(i.querySelector(".popup__form_avatar"),s.querySelector(".popup__form_add-card"),r.querySelector(".popup__form_edit"),document.querySelector(".profile__edit-button")),a=document.querySelector(".profile__add-button"),l=(document.querySelector(".popup__input_type_card-name"),document.querySelector(".popup__input_type_card-link"),document.querySelector(".cards__grid"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class d{constructor(e,t,r,s,i,n,o,a){var l=a.handleCardClick,d=a.handleDeleteClick,h=a.handleLikeClick;c(this,"_fillCard",(()=>{this._cardElement.querySelector(".card__title").textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=this._name})),c(this,"_addLike",(()=>{this._likeButton.classList.add("card__like-active")})),c(this,"_removeLike",(()=>{this._likeButton.classList.remove("card__like-active")})),this._name=e,this._link=t,this._likes=r,this._id=s,this._userId=i,this._ownerId=n,this._template=document.querySelector(o).content.querySelector(".card"),this._handleCardClick=l,this._handleDeleteClick=d,this._handleLikeClick=h}getCardElement(){return this._cardElement=this._template.cloneNode(!0),this._cardImage=this._cardElement.querySelector(".card__image"),this._deleteButton=this._cardElement.querySelector(".card__delete"),this._likeButton=this._cardElement.querySelector(".card__like"),this._fillCard(),this._setEventListeners(),this.setLikes(this._likes),this._ownerId!==this._userId&&(this._deleteButton.style.display="none"),this._cardElement}isLiked(){return this._likes.find((e=>e._id===this._userId))}setLikes(e){this._likes=e,this._cardElement.querySelector(".card__like-count").textContent=e.length,this.isLiked()?this._addLike():this._removeLike()}deleteImage(){this._cardElement.remove()}_setEventListeners(){this._cardImage.addEventListener("click",(()=>this._handleCardClick(this._name,this._link))),this._deleteButton.addEventListener("click",(()=>this._handleDeleteClick(this._id))),this._likeButton.addEventListener("click",(()=>this._handleLikeClick(this._id)))}}class h{constructor(e){var t,r;r=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this._popupSelector=document.querySelector(e)}open(){this._popupSelector.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupSelector.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popupSelector.addEventListener("mousedown",(e=>{e.target.classList.contains("popup_opened")&&this.close(),e.target.classList.contains("popup__close")&&this.close()}))}}class _ extends h{constructor(e,t){var r=t.handlerSubmit;super(e),this._handlerSubmit=r,this._form=this._popupSelector.querySelector(".popup__form"),this._inputs=this._form.querySelectorAll(".popup__input"),this._saveButton=this._form.querySelector(".popup__save")}_getInputValues(){return this._values={},this._inputs.forEach((e=>{this._values[e.name]=e.value})),this._values}close(){super.close(),this._form.reset()}renderLoading(e){this._saveButton.textContent=e?"Сохранение...":"Сохранить"}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handlerSubmit(this._getInputValues())}))}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class p{constructor(e,t){u(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideError(e):this._showError(e,e.validationMessage)})),u(this,"_isFormValid",(()=>this._inputList.some((e=>!e.validity.valid)))),u(this,"disableSubmitButton",(()=>{this._buttonElement.classList.add(this._settings.inactiveButtonClass),this._buttonElement.disabled=!0})),u(this,"_enableSubmitButton",(()=>{this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.disabled=!1})),u(this,"_toggletButtonState",(()=>{this._isFormValid()?this.disableSubmitButton():this._enableSubmitButton()})),u(this,"_setEventListeners",(()=>{this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggletButtonState()}))}))})),this._form=t,this._settings=e,this._inputList=Array.from(this._form.querySelectorAll(this._settings.inputSelector)),this._buttonElement=this._form.querySelector(this._settings.submitButtonSelector)}_showError(e,t){var r=this._form.querySelector("#".concat(e.id,"-error"));e.classList.add(this._settings.inputErrorClass),r.classList.add(this._settings.errorClass),r.textContent=t}_hideError(e){var t=this._form.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass),t.textContent=""}resetValidation(){this._toggletButtonState(),this._inputList.forEach((e=>{this._hideError(e)}))}enableValidation(){this.disableSubmitButton(),this._setEventListeners()}}var m,v=new class{constructor(e){var t=e.baseUrl,r=e.headers;this._baseUrl=t,this._headers=r}_checkServerResponse(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}getProfile(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then(this._checkServerResponse)}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then(this._checkServerResponse)}editProfile(e,t){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkServerResponse)}addCard(e,t){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkServerResponse)}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkServerResponse)}addLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then(this._checkServerResponse)}deleteLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then(this._checkServerResponse)}changeAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkServerResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-37",headers:{authorization:"a0b3e2e0-8bf7-47b3-9f51-e543921e1ae3","Content-Type":"application/json"}});function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}Promise.all([v.getInitialCards(),v.getProfile()]).then((e=>{var t,r,s=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,i,n=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(s=r.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return n}}(t,r)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=s[0],n=s[1];E.setUserInfo(n.name,n.about,n.avatar),m=n._id,i.reverse(),y.renderItems(i)})).catch((e=>{console.log(e)}));var b=new class extends h{constructor(e){super(e),this._form=this._popupSelector.querySelector(".popup__form")}setFormSubmitHandler(e){this.setFormSubmitHandler=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this.setFormSubmitHandler()}))}}(".popup_type_delete-confirm"),f=new class extends h{constructor(e){super(e),this._caption=this._popupSelector.querySelector(".popup__open-photo-subtitle"),this._image=this._popupSelector.querySelector(".popup__open-photo")}open(e,t){this._caption.textContent=e,this._image.src=t,this._image.alt=e,super.open()}}(".popup_type_open-card"),y=new class{constructor(e,t){var r=e.renderer;this._renderer=r,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderItems(e){e.forEach((e=>{this._renderer(e,this._container)}))}}({items:[],renderer:e=>{y.addItem(k({name:e.name,link:e.link,likes:e.likes,_id:e._id,userId:m,ownerId:e.owner._id}))}},".cards__grid");function k(e){var t=new d(e.name,e.link,e.likes,e._id,m,e.ownerId,".card-template",{handleCardClick:(e,t)=>{f.open(e,t)},handleDeleteClick:e=>{b.setFormSubmitHandler((()=>{v.deleteCard(e).then((e=>{t.deleteImage(),b.close()})).catch((e=>{console.log(e)}))})),b.open()},handleLikeClick:e=>{t.isLiked()?v.deleteLike(e).then((e=>{t.setLikes(e.likes)})).catch((e=>{console.log(e)})):v.addLike(e).then((e=>{t.setLikes(e.likes)})).catch((e=>{console.log(e)}))}});return t.getCardElement()}var E=new class{constructor(e){var t=e.profileNameSelector,r=e.profileDescriptionSelector,s=e.profileAvatarSelector;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(r),this._avatarElement=document.querySelector(s)}getUserInfo(){return{name:this._nameElement.textContent,about:this._jobElement.textContent}}setUserInfo(e,t,r){this._nameElement.textContent=e,this._jobElement.textContent=t,this._avatarElement.src=r}}({profileNameSelector:".profile__title",profileDescriptionSelector:".profile__subtitle",profileAvatarSelector:".profile__avatar"}),L=new _(".popup_type_add-card",{handlerSubmit:e=>{L.renderLoading(!0),v.addCard(e.cardtitle,e.cardlink).then((e=>{var t={name:e.name,link:e.link,likes:e.likes,_id:e._id,userId:m,ownerId:e.owner._id};y.addItem(k(t)),L.close()})).catch((e=>{console.log(e)})).finally((()=>{L.renderLoading(!1)}))}}),g=new _(".popup_type_edit",{handlerSubmit:e=>{g.renderLoading(!0),v.editProfile(e.name,e.about).then((e=>{E.setUserInfo(e.name,e.about,e.avatar),g.close()})).catch((e=>{console.log(e)})).finally((()=>{g.renderLoading(!1)}))}}),C=new _(".popup_type_avatar",{handlerSubmit:e=>{C.renderLoading(!0);var t=e.avatar;v.changeAvatar(t).then((e=>{E.setUserInfo(e.name,e.about,e.avatar),C.close()})).catch((e=>{console.log(e)})).finally((()=>{C.renderLoading(!1)}))}});o.addEventListener("click",(()=>{g.open();var r=E.getUserInfo(),s=r.name,i=r.about;e.value=s,t.value=i,q.resetValidation()})),a.addEventListener("click",(()=>{I.disableSubmitButton(),L.open(),I.resetValidation()})),n.addEventListener("click",(()=>{w.disableSubmitButton(),C.open(),w.resetValidation()}));var q=new p(l,r),I=new p(l,s),w=new p(l,i);q.enableValidation(),I.enableValidation(),w.enableValidation(),f.setEventListeners(),L.setEventListeners(),g.setEventListeners(),b.setEventListeners(),C.setEventListeners()})();